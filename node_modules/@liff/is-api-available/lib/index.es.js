import{__extends as e}from"tslib";import{FORBIDDEN as i,UNAUTHORIZED as n,INVALID_ARGUMENT as r}from"@liff/consts";import{LiffModule as o}from"@liff/use";import{compareVersion as a,isLIFFBrowser as t,isLINEBrowser as l,createLiffError as s}from"@liff/util";import{isSubWindow as c}from"@liff/is-sub-window";import{getContext as u}from"@liff/store";import{getLineVersion as f}from"@liff/get-line-version";import{isInClient as d}from"@liff/is-in-client";import{isLoggedIn as p}from"@liff/is-logged-in";function m(e){var i,n=u();return null===(i=null==n?void 0:n.availability)||void 0===i?void 0:i[e]}function v(e,n){var r=m(e);if(!r||!r.permission)return{available:!1,error:{code:i,message:"".concat(e," is not allowed in this LIFF app")}};var o=r.minVer,t=r.unsupportedFromVer;if(d()){var l=function(e,i){var n=f();return!!n&&!(i&&a(n,i)>0)&&a(n,e)>=0}(o,t);return l?{available:!0}:{available:!1,error:{code:i,message:"".concat(e," is unavailable in this client version.")}}}return n?{available:!0}:{available:!1,error:{code:i,message:"".concat(e," is not allowed in external browser")}}}var b=function(){return p()?!t()&&l()?{available:!1,error:{code:i,message:"Subwindow is not supported in this browser"}}:c()?{available:!1,error:{code:i,message:"this api can be only called in child window"}}:v("subwindowOpen",!0):{available:!1,error:{code:n,message:"Need access_token for api call, Please login first"}}},g=["subwindowOpen","shareTargetPicker","multipleLiffTransition","scanCode","scanCodeV2","getAdvertisingId","addToHomeScreen","bluetoothLeFunction","skipChannelVerificationScreen"],h={scanCode:function(){return v("scanCode")},getAdvertisingId:function(){return v("getAdvertisingId")},bluetoothLeFunction:function(){return v("bluetoothLeFunction")},shareTargetPicker:function(){return c()?{available:!1,error:{code:i,message:"this api can be only called in child window"}}:p()?v("shareTargetPicker",!0):{available:!1,error:{code:n,message:"Need access_token for api call, Please login first"}}},multipleLiffTransition:function(){var e=m("multipleLiffTransition");return e&&e.permission?d()?{available:!0}:{available:!1,error:{code:i,message:"multipleLiffTransition is available only in the LINE App browser"}}:{available:!1,error:{code:i,message:"multipleLiffTransition is not allowed in this LIFF app"}}},subwindowOpen:b,scanCodeV2:function(){if(!p())return{available:!1,error:{code:n,message:"Need access_token for api call, Please login first"}};var e=b();return e.available?v("scanCodeV2",!0):e},addToHomeScreen:function(){return c()?{available:!1,error:{code:i,message:"this api can be only called in child window"}}:v("addToHomeScreen")},skipChannelVerificationScreen:function(){var e=u();return e?"square_chat"===e.type?{available:!1,error:{code:i,message:"skipChannelVerificationScreen is not allowed in OpenChat"}}:v("skipChannelVerificationScreen"):{available:!1,error:{code:i,message:"Context is not found"}}}},w=function(e){return function(){var i=e();if(!i.available)throw s(i.error.code,i.error.message)}},C={scanCode:w(h.scanCode),getAdvertisingId:w(h.getAdvertisingId),bluetoothLeFunction:w(h.bluetoothLeFunction),shareTargetPicker:w(h.shareTargetPicker),multipleLiffTransition:w(h.multipleLiffTransition),subwindowOpen:w(h.subwindowOpen),scanCodeV2:w(h.scanCodeV2),addToHomeScreen:w(h.addToHomeScreen),skipChannelVerificationScreen:w(h.skipChannelVerificationScreen)};function T(e){if(!function(e){return g.some((function(i){return i===e}))}(e))throw s(r,"Unexpected API name.");var i=h[e];return!i||i().available}var k=function(i){function n(){var e=null!==i&&i.apply(this,arguments)||this;return e.hooks={},e}return e(n,i),Object.defineProperty(n.prototype,"name",{get:function(){return"isApiAvailable"},enumerable:!1,configurable:!0}),n.prototype.install=function(){return function(e){return T(e)}},n}(o);export{k as IsApiAvailableModule,T as isApiAvailable,C as validators};
